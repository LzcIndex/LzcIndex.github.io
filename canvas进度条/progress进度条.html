<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>Document</title>
	</head>
	<body style="text-align: center;">
		<canvas id="canvas" width="500" height="100"></canvas>

		<script>
			/** @type {HTMLCanvasElement} */
			var canvas = document.querySelector("#canvas");
			var ctx = canvas.getContext("2d");

			// 进度条宽度
			let bar = 0;
			let frames = 0;
			let bolls = [];
			let barColor = [randomNum(0, 255, true), randomNum(0, 255, true), randomNum(0, 255, true)];

			// 生成随机数 m-n之间 是否整数
			function randomNum(m, n, int) {
				if (int) {
					return Math.floor(Math.random() * (n - m) + m);
				} else {
					return Math.random() * (n - m) + m;
				}
			}
			// 生成随机颜色
			function randomColor() {
				return `rgba(${randomNum(50, 200, true)},${randomNum(50, 200, true)},${randomNum(50, 200, true)})`;
			}

			class Boll {
				constructor(...values) {
					[this.x, this.y, this.r, this.c] = values;
				}
				// 画出圈圈
				draw() {
					ctx.beginPath();
					ctx.arc(this.x, this.y, this.r, 0, 2 * Math.PI);
					ctx.closePath();
					ctx.fillStyle = this.c;
					ctx.fill();
				}
				// 生成初始速度
				generateSpeed(m, n, int) {
					this.sx = -randomNum(m, n, int) / 3;
					this.sy = -randomNum(m, n, int);
				}

				//
				move() {
					this.x += this.sx;
					this.y += this.sy;
				}

				// 更新小球速度 更新小球半径
				updateBoll() {
					this.sy += 0.1;
					this.r = this.r - 0.02;
					if (this.r <= 0) {
						this.r = 0;
					}
				}
			}

			let id = setInterval(() => {
				// 更新进度条 帧数
				frames++;
				bar += 0.5;

				// 清空画布
				ctx.clearRect(0, 0, 500, 500);

				// 绘制进度条底层
				ctx.fillStyle = "lightgray";
				ctx.fillRect(50, 45, 400, 10);

				// 绘制进度条

				ctx.fillStyle = "orange";
				ctx.fillRect(50, 45, bar, 10);

				// 每10帧 生成小球球
				if (frames % 2 === 0) {
					let b = new Boll(bar + 50, 45, 2, randomColor());
					bolls.push(b);
					b.draw();
					// 初始化小球 速度
					b.generateSpeed(2, 4, false);
				}

				// 每帧移动小球 画出新小球 更新小球速度
				for (boll of bolls) {
					boll.move();
					boll.draw();
					boll.updateBoll();
				}
				// 半径小于等于0 就删掉
				bolls.forEach((boll, index, bolls) => {
					if (boll.r <= 0) {
						bolls.splice(index, 1);
					}
				});

				if (bar >= 400) {
					// clearInterval(id);
				}
			}, 30);
		</script>
	</body>
</html>
